import"../chunks/disclose-version.Bg9kRutz.js";import{p as S,f as C,b as F,g as o,s as H,d as i,a as l,e as P}from"../chunks/utils.CJAfLu7n.js";import{a as x,t as z}from"../chunks/template.CV4TamR3.js";import{b as A,p as m}from"../chunks/preload-helper.4zoQEAJ5.js";import{o as E}from"../chunks/index-client.B2ZHp8Gn.js";import{i as R,g as U}from"../chunks/common.BvlOTgvE.js";import{M as O}from"../chunks/markmap.Buesja9a.js";import{T as V}from"../chunks/toolbar.DQ53-pWM.js";var X=z("<!> <!>",1);function W(v,b){S(b,!0);let c=i(!1),r=i(void 0),d=i(""),f=i(!0);const M={setData(t){l(d,m(t))},setCursor(t){o(r).setCursor(t)},setFit(t){l(f,m(t))},downloadSvg(){var a,n;const t=(n=(a=o(r))==null?void 0:a.getMarkmap())==null?void 0:n.svg.node();if(!t)return;const e=new XMLSerializer().serializeToString(t);s("downloadSvg",e)},downloadHtml(){const t=U();if(!t)return;const e=t.transform(o(d));s("downloadHtml",{result:e})},updateTheme(t){R.set(t)}};function p(t){const{type:e,data:a}=t.data,n=M[e];n==null||n(a)}function s(t,e){parent.postMessage({type:t,data:e},window.location.origin)}function h(){s("getData")}function k(){l(c,!0)}function _(){o(r).getMarkmap().g.selectAll(function(){return Array.from(this.childNodes).filter(e=>e.tagName==="g")}).on("dblclick.focus",(t,e)=>{var w;const a=(w=e.payload)==null?void 0:w.lines,n=+(a==null?void 0:a.split(",")[0]);isNaN(n)||s("setCursor",n)},!0)}function L(){s("goToFullPage")}function T(){window.location.reload()}function y(t){const e=new URL(t,window.top.location.href);return e.origin===window.location.origin?s("navigate",t):window.open(e,"_blank"),!1}E(()=>(window.addEventListener("message",p),h(),()=>{window.removeEventListener("message",p)}));var g=X(),u=C(g);A(O(u,{class:"w-screen h-screen",get fit(){return o(f)},get content(){return o(d)},onLoad:k,onUpdate:_,onReload:T,onOpenLink:y}),t=>l(r,m(t)),()=>o(r));var D=H(u,2),N=P(()=>{var t;return o(c)&&((t=o(r))==null?void 0:t.getMarkmap())});V(D,{class:"absolute right-0 bottom-0 mr-2 mb-2",get markmap(){return o(N)},onFullPageView:L}),x(v,g),F()}export{W as component};
