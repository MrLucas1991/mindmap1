import"./disclose-version.Bg9kRutz.js";import{p as X,u as Y,f as Z,t as b,b as $,s as T,g as l,d as tt,h as et,a as _}from"./utils.CJAfLu7n.js";import{i as at,e as nt}from"./if.Dfke5Qdj.js";import{a as A,t as E}from"./template.CV4TamR3.js";import{a as it,e as rt,l as st,g as q,t as ot,b as ct,u as ft,U as lt,c as mt,s as p}from"./common.BvlOTgvE.js";import{s as ut}from"./class.cTksmFMZ.js";import{b as dt,p as J}from"./preload-helper.4zoQEAJ5.js";import{p as k}from"./props.DPVyA6hB.js";import{o as ht}from"./index-client.B2ZHp8Gn.js";import{d as gt}from"./debounce.CLTjDgnO.js";var yt=E('<link rel="stylesheet" type="text/css">'),vt=E('<div class="markmap-highlight-area"></div>'),wt=E('<!> <!> <svg xmlns="http://www.w3.org/2000/svg"></svg>',1);function Rt(D,i){X(i,!0);let u=k(i,"content",7,""),F=k(i,"style",3,""),O=k(i,"fit",3,!0),S=k(i,"class",3,"");const M=it(),j={};let s,x,d;const h={};let o=tt(void 0);function U(t,e){let a=!1;return{promise:new Promise((r,f)=>{const c=performance.now(),g=()=>{const m=performance.now()-c,y=Math.min(m/t,1);if(e(y),y<1&&!a)return requestAnimationFrame(g);(a?f:r)()};requestAnimationFrame(g)}),abort:()=>{a=!0}}}function B(t){let e=t?{key:Symbol("highlight"),x:t.x,y:t.y,width:t.width,height:t.height,opacity:1}:void 0;if(_(o,J(e)),e){const{abort:a,promise:n}=U(500,r=>{var f;if(e.key!==((f=l(o))==null?void 0:f.key))return a();e.opacity=1-r,_(o,J(e))});n.finally(()=>{var r;e.key===((r=l(o))==null?void 0:r.key)&&_(o,void 0)})}}function H(){return s}async function P(t){var a;if(!s)return;const e=I(t);if(e){await s[j.placement==="center"?"centerNode":"ensureVisible"](e,{bottom:60});const n=(a=s.findElement(e))==null?void 0:a.g,r=n==null?void 0:n.getBoundingClientRect();B(r)}}const C=gt(()=>s.fit(),200);let N;async function v(t,e=!1){var a,n,r,f;if(s&&(t!==N||e)){d=q().transform(t||"");const c=(a=d.frontmatter)==null?void 0:a.markmap;j.placement=(n=c==null?void 0:c.activeNode)==null?void 0:n.placement;const g=ft(c),{extraJs:m,extraCss:y}=c||{};h.js&&!V(h.js,m)?(r=i.onReload)==null||r.call(i):!h.js&&m&&(h.js=m,G()),h.css=y,N=t,await s.setData(d.root,{...lt,...g}),(f=i.onUpdate)==null||f.call(i),O()&&await s.fit()}}function V(t,e){return Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every((a,n)=>a===e[n])}async function G(){await M,await mt(h.js.map(t=>({type:"script",data:{src:t}}))),v(u(),!0)}function I(t){function e(n){var c,g,m;const[r,f]=((g=(c=n.payload)==null?void 0:c.lines)==null?void 0:g.split(",").map(y=>+y))||[];r>=0&&r<=t&&t<f&&(a=n),(m=n.children)==null||m.forEach(e)}let a;return d!=null&&d.root&&e(d.root),a}function K(t){var a,n;const e=(a=t.target)==null?void 0:a.closest("a");if(e){const r=e.getAttribute("href");((n=i.onOpenLink)==null?void 0:n.call(i,r))===!1&&t.preventDefault()}}Y(()=>{u(u()),et(()=>{v(u())})});async function Q(){var e;await M;const t=[st.tap(()=>{v(u(),!0)}),q().hooks.retransform.tap(()=>{v(u(),!0)})];return s=ot.create(x),v(u()),(e=i.onLoad)==null||e.call(i),window.addEventListener("resize",C),()=>{var a;window.removeEventListener("resize",C),t.forEach(n=>{n()}),(a=s==null?void 0:s.destroy)==null||a.call(s),s=void 0}}ht(()=>{const t=Q();return()=>{t.then(e=>e==null?void 0:e())}});var R=wt(),z=Z(R);rt(z,17,()=>h.css||[],ct,(t,e)=>{var a=yt();b(()=>p(a,"href",l(e))),A(t,a)});var L=T(z,2);{var W=t=>{var e=vt();b(()=>p(e,"style",`left:${l(o).x}px;top:${l(o).y}px;width:${l(o).width}px;height:${l(o).height}px;opacity:${l(o).opacity};`)),A(t,e)};at(L,t=>{l(o)&&t(W)})}var w=T(L,2);return dt(w,t=>x=t,()=>x),b(()=>{ut(w,`${S()} leading-none`),p(w,"style",F())}),nt("click",w,K),A(D,R),$({getMarkmap:H,setCursor:P})}export{Rt as M};
